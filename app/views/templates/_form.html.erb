<div class="custom-container">
  <div class="row">
    <div class="col-md-12 col-xs-12">
      
      <div class="col-md-11 col-xs-10">
        <%= form_for(@template, :html => {:class => 'form-horizontal'}) do |f| %>
        <div class="form-group form-group-sm">
          <%= f.label :name, t('frontend.template.name'), :class => "col-sm-3 col-xs-3 control-label" %>
          <div class="col-sm-5 col-xs-5">
            <%= f.text_field :name, :class => 'form-control', :maxlength => 250 %>
          </div>
        </div>

        <div class="form-group form-group-sm">
            <%= f.label :profile_id, :class => "col-sm-3 col-xs-12 control-label"%>      
            <div class="col-sm-5 col-xs-5">
              <%= collection_select(:template, :profile_id, Profile.active, :id, :name, {:prompt => t('frontend.template.select_profile')}, {:class => 'form-control'}) %> 
            </div>
        </div>

        <div class="form-group form-group-sm">
          <%= f.label :content, t('frontend.template.content'), :class => "col-sm-3 col-xs-3 control-label" %>
          <div class="col-sm-6 col-xs-6">
            <%= f.text_area :content, class: 'summernote',:contenteditable =>"true" %>
          </div>

           <div class="col-sm-3 col-xs-3" style = "background-color: whitesmoke;">
             <h4 style="background-color: powderblue;">Select variable to substitute in template</h4>
             <% Profile.active.find_each do |profile|%>
               <div style="background-color: white;">
                 <b><%= profile.name.capitalize %><label class="e_specchar" value = *|<%= profile.name %>|* ><%= profile.name.capitalize %></label></b></br>
                 <%= profile.extra_fields.map(&:field_name).join(' ')%>
               </div>
               <div class="clearfix"></div>
               </br>
             <% end %>
           </div>
        </div>



        <div class="form-group form-group-sm field">
          <label class="col-sm-3 col-xs-3 control-label custom-my-label"><%= t('activerecord.attributes.template.status') %></label>
          <div class="col-sm-9 col-xs-9">
            <%= f.radio_button :status ,1, :checked => @template.new_record? ? true : @template.status ,:id=>"radio01" %>
            <label for="radio01" class="status_spacer"><span></span><%= t('frontend.shared.enabled') %></label>
            <%= f.radio_button :status ,0, :checked => @template.new_record? ? false : !@template.status ,:id=>"radio02" %>
            <label for="radio02"><span></span><%= t('frontend.shared.disabled') %></label>
          </div>
        </div>
       
        <div class="col-lg-4 col-xs-1">
          <div class="form-group form-group-sm">
          <label class="col-sm-4 col-xs-12 control-label">&nbsp;</label>
          <div class="col-sm-8 col-xs-12 custom-radio-input">&nbsp;</div>
        </div>
      </div>
      <div class="clearfix"></div>
      <div class="divider"></div>
    </div>

    <div class="col-md-12 col-xs-12">
        <div class="col-lg-2 col-xs-1">&nbsp;</div>
        <div class="col-md-5 col-xs-10">
          <div class="form-group custom-from-group">
            <div class="col-xs-4">&nbsp;</div>
                        
            <div class="col-xs-8 text-left">
              <%= f.submit t('buttons.save') ,:class => 'btn dark-btn-custom'%>
              <%= link_to t('cancel'), templates_path, class: 'btn custom-link-btn' %>
            </div>
        </div>
                         
      </div>
      <div class="col-lg-4 col-xs-1">&nbsp;</div>
      <div class="clearfix"></div>    
    <% end %>
    </div>
  </div><!-- row -->
</div><!--  custom-container -->

<script type="text/javascript">
  $(document).ready(function(){
     var selection = '';
     var cursorPos = '';
     var oldContent = '';
     var node = '';
    $('.note-editable').on('blur',function(){
      selection = document.getSelection();
      cursorPos = selection.anchorOffset;
      oldContent = selection.anchorNode.nodeValue;
      node = selection.anchorNode;
      console.log(node);
    });
    $('.e_specchar').click(function(){
      if (typeof selection !== 'undefined') {
        var toInsert = $(this).attr('value');
        length = $(this).attr('value').length;
        var newContent = oldContent.substring(0, cursorPos) + ' ' + toInsert + ' ' + oldContent.substring(cursorPos);
        node.nodeValue = newContent;
        oldContent = newContent;
        cursorPos = cursorPos + length + 1;
      }
    });

  });
</script>