<script type="text/javascript">
  $( document ).ready(function() {
      $.ajax({
        url: '/companies/select_roles',
        data: "id="+$('#user_company_id').val()
      });
      
    $('#user_company_id').on('change', function() {      
      $.ajax({
        url: '/companies/select_roles',
        data: "id="+$(this).val()
      });
    });
  });
</script>
<div class="custom-container">
  <div class="row">
    <div class="col-md-12 col-xs-12">
      <div class="col-lg-2 col-xs-1">&nbsp;</div>
        <div class="col-md-6 col-xs-10">
          <%= form_for(@user, :validate => true, :html => {:class => 'form-horizontal', :multipart => true}) do |f| %>
            
            <% if current_user.is_admin? %>
              <div class="field form-group form-group-sm role_company">
                <%= f.label :company_id, :class => "col-sm-3 col-xs-12 control-label" %>
                <div class="col-sm-9 col-xs-12"> <%= collection_select(:user, :company_id, Company.all, :id, :name, {:prompt => 'Please select a company'}, {:class => 'form-control'}) %>  </div>
              </div> 
              <div class="field form-group form-group-sm">
                <%= f.label :role_id, :class => "col-sm-3 col-xs-12 control-label" %>
                <div class="col-sm-9 col-xs-12" id="dynamic_company_roles">
                  <%= collection_select(:user, :role_id, [], :id, :name, {:prompt => 'Please select a role'}, {:class => 'form-control'}) %> 
                </div>
              </div>

            <% else %>
              <div class="field form-group form-group-sm role_company">
                <%= f.label :company_id, :class => "col-sm-3 col-xs-12 control-label" %>
                <div class="col-sm-9 col-xs-12"> <%= collection_select(:user, :company_id, [current_user.company], :id, :name, {}, {:class => 'form-control'}) %>  </div>
              </div> 
              <div class="field form-group form-group-sm">
                <%= f.label :role_id, :class => "col-sm-3 col-xs-12 control-label" %>
                <div class="col-sm-9 col-xs-12">
                  <%= collection_select(:user, :role_id, current_user.company.roles, :id, :name, {:prompt => 'Please select a role'}, {:class => 'form-control'}) %> 
                </div>
              </div>
            <% end %>

            <div class="field form-group form-group-sm">
              <%= f.label :email, :class => "col-sm-3 col-xs-12 control-label" %>
              <div class="col-sm-9 col-xs-12"> <%= f.text_field :email, :class => 'form-control' %> </div>
            </div>          
            <div class="field form-group form-group-sm">
              <%= f.label :username, :class => "col-sm-3 col-xs-12 control-label" %>
              <div class="col-sm-9 col-xs-12"> <%= f.text_field :username, :class => 'form-control' %> </div>
            </div> 
            <div class="field form-group form-group-sm">
              <%= f.label :password, :class => "col-sm-3 col-xs-12 control-label" %>
              <div class="col-sm-9 col-xs-12"> <%= f.password_field :password, :class => 'form-control' %> </div>
            </div> 
            <div class="field form-group form-group-sm">
              <%= f.label :password_confirmation, :class => "col-sm-3 col-xs-12 control-label" %>
              <div class="col-sm-9 col-xs-12"> <%= f.password_field :password_confirmation, :class => 'form-control' %> </div>
            </div> 

            <div class="form-group form-group-sm field">
              <%= f.label :status, :class => "col-sm-3 col-xs-12 control-label" %>
              <div class="col-sm-9 col-xs-12 radio_status">
                <%= f.radio_button :status, true , :checked => @user.new_record? ? true : @user.status , :value => true %>
                <%= label :status, "Enabled", :class =>"status_spacer" %>

                <%= f.radio_button :status, false , :checked => @user.new_record? ? false : !@user.status , :value => false %>
                <%= label :status, "Disabled" %>
              </div>
            </div>

<!--             <div class="field form-group form-group-sm">
              <%#= f.label :image, :class => "col-sm-3 col-xs-12 control-label" %>
              <div class="col-sm-9 col-xs-12"> 
                <%#= f.file_field :image, :class => 'form-control' %> 
                <%#= f.hidden_field :image_cache %>
              </div>
            </div> -->
      <div class="clearfix"></div>
      <div class="divider"></div>
    </div>

      <div class="col-md-12 col-xs-12">
        <div class="col-lg-2 col-xs-1">&nbsp;</div>
        <div class="col-md-5 col-xs-10">
          <div class="form-group custom-from-group">
            <div class="col-xs-4">&nbsp;</div>
                        
            <div class="col-xs-8 text-left">
              <%= f.submit :Save ,:class => 'btn dark-btn-custom'%>
              <%= link_to "Cancel", users_path %>
            </div>
        </div>
                         
      </div>
      <div class="col-lg-4 col-xs-1">&nbsp;</div>
      <div class="clearfix"></div>    
      <% end %>
    </div>
  </div><!-- row -->
</div><!--  custom-container -->
